---
title: "sysctl"
subtitle: " "
description: " "
date: 2025-08-01T05:57:11Z
author:      "Wayne"
image: ""
tags: ["sysctl", "sysctl.conf", "sysctl.d"]
categories: ["Tech"]
---

![alt text](/img/image-33.png)

# /etc/sysctl.conf 和 /etc/sysctl.d/ 同时存在

从上图可以看到 `/etc/sysctl.conf` 和 `/etc/sysctl.d/` 同时存在是正常现象，这是 Linux 系统（特别是基于 systemd 的系统）对内核参数（sysctl）配置的两种并存机制，并且它们是**有优先级和加载顺序的**。

## /etc/sysctl.conf

- 是最传统的 sysctl 配置文件；
- 通常在早期 Linux 系统中使用；
- 是一个单一文件，用于设置内核参数；
- 内容例子：
  ```ini
  net.ipv4.ip_forward = 1
  vm.swappiness = 10
  ```

## /etc/sysctl.d/（推荐方式）

- 是一种更现代、更模块化的方式；
- 是一个目录，可以包含多个 .conf 文件，例如：

  ```vbnet
  10-network.conf
  20-kernel.conf
  99-custom.conf
  ```

- {{<rawhtml>}}<span style="color:red;">用于将 sysctl 设置拆分到多个文件中，便于管理与覆盖。</span>{{</rawhtml>}}

### /etc/sysctl.d/目录下文件名的数字前缀的作用

systemd 会 按文件名的字典顺序 读取 _/etc/sysctl.d/_ 下的所有 .conf 文件，并依次应用其中的内核参数。数字前缀的作用是：**控制优先级**

- 文件名排得越前（数字小），越早被加载。
- 文件名排得越后（数字大），越晚被加载，如果同一参数在多个文件中设置了，后加载的会覆盖前面的值。

demo:

```bash
10-default.conf # 最早加载
20-network.conf
50-tweaks.conf
99-sysctl.conf      # 最晚加载，通常用于“最终覆盖”或用户自定义
```

# 加载优先级顺序

系统在启动时通过 systemd-sysctl 服务读取内核参数，以下目录的文件**会按顺序依次加载**：

```text
/etc/sysctl.d/*.conf           # 用户自定义配置（最优先）
/run/sysctl.d/*.conf           # 运行时配置（临时）
/usr/lib/sysctl.d/*.conf       # 系统或软件包提供的默认配置
/etc/sysctl.conf               # 最后加载（但在 sysctl.d 之后）

# 注意：如果同一个参数出现在多个文件中，后加载的会覆盖前面的值。
```

# 如何查看当前生效的 sysctl 值

```bash
sysctl -a

# 或者查特定值：
sysctl net.ipv4.ip_forward
```

# 应用配置修改

如果你修改了 _/etc/sysctl.conf_ 或 _/etc/sysctl.d/\*.conf_ 文件，执行：

```bash
sudo sysctl --system
```

会重新读取上述所有路径下的配置文件，并应用其中的设置。

# summary

| 配置对比         | 是否推荐 | 可扩展性       | 优先级     | 说明                                 |
| :--------------- | :------- | :------------- | :--------- | :----------------------------------- |
| /etc/sysctl.conf | 不推荐   | 单一文件       | 最后加载   | 传统方法，可能被 .d 覆盖             |
| /etc/sysctl.d/   | 推荐     | 模块化、易维护 | 中间优先级 | 支持多个配置文件，便于定制和升级管理 |
