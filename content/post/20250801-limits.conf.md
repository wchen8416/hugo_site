---
title: "limits.conf"
subtitle: " "
description: " "
date: 2025-08-01T07:51:20Z
author:      "Wayne"
image: ""
tags: ["/etc/security/limits.conf", "/etc/security/limits.d", "limits.conf"]
categories: ["Tech"]
---

_/etc/security/limits.conf_ 和 _/etc/security/limits.d/_ 是 PAM（Pluggable Authentication Modules）系统中设置用户资源限制（如最大文件数、进程数、内存等）的配置路径，它们共同构成了资源限制（ulimit）设置的机制。

- /etc/security/limits.conf 是主配置文件。
- /etc/security/limits.d/ 是**目录形式的扩展配置文件**，可用于分模块、分服务、分用户单独配置。

# 加载顺序和优先级

PAM 的 pam_limits.so 模块在登录时会：

1. 先加载 /etc/security/limits.conf
2. 再加载 /etc/security/limits.d/\*.conf 中的所有文件，按字典序排序（如 10-nproc.conf, 99-custom.conf）

如果有冲突，后加载的配置会覆盖前面的设置。所以你可以用 /etc/security/limits.d/99-my.conf 来覆盖默认设置。

## 为什么有两个位置？

- 将配置拆分为多个文件更灵活，便于包管理器或运维脚本自动管理（如某软件在安装时写入 /etc/security/limits.d/ 而不改主文件）。
- 避免直接编辑 limits.conf，保持其简洁，便于升级或迁移时维护。

# demos

1. 示例：配置最大文件数（nofile）

/etc/security/limits.conf :

```ini
* soft nofile 1024
* hard nofile 2048
```

/etc/security/limits.d/90-nofile.conf:

```ini
myuser soft nofile 4096
myuser hard nofile 8192
```

结果：myuser 的 nofile 设置会以 90-nofile.conf 为准，覆盖了 limits.conf 中的 \* 通配设置。

# summary

| 项目                      | 说明                                                                 |
| :------------------------ | :------------------------------------------------------------------- |
| /etc/security/limits.conf | 主配置文件，默认优先加载                                             |
| /etc/security/limits.d/   | 扩展目录，加载后覆盖主配置，可模块化管理                             |
| 加载顺序                  | limits.conf → limits.d/\*.conf（按文件名字典序）                     |
| 应用场景                  | 配置 ulimit 相关如：最大进程数、最大打开文件、最大内存、stack 大小等 |
