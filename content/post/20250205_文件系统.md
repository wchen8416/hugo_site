---
title: "Logic Block Address"
subtitle: ""
description: "介绍文件系统的LBA（逻辑块地址）的概念。"
date: 2025-02-05T15:52:11Z
author:      "Wayne"
image: ""
tags: ["read", "文件系统", "file system", "LBA"]
categories: ["Tech"]
---

## LBA（逻辑块地址）

这里我们先穿插一个关于硬盘的结构介绍，关于硬盘结构可能很多读者已经有一个大概的了解，那就是硬盘基本存储单位为扇区(Sector ),每个扇区一般为 512 字节。一个硬盘往往有多个盘片，每个盘片分两面，每面按照同心圆划分为若干个磁道，每个磁道划分为若干个扇区。比如一个硬盘有 2 个盘片，每个盘面分 65536 磁道，每个磁道分 1024 个扇区，那么硬盘的容量就是 2*2*65536*1024*512=137438953472 字节(128GB)。但是我们可以想象，每个盘面上同心圆的周长不一样，如果按照每个磁道都拥有相同数量的扇区，那么靠近盘面外围的磁道密度肯定比内圈更加稀疏，这样是比较浪费空间的。但是如果不同的磁道扇区数又不同，计算起来就十分麻烦。**为了屏蔽这些复杂的硬件细节，现代的硬盘普遍使用一种叫做 LBA(Logical Block Address)的方式，即整个硬盘中所有的扇区从 0 开始编号，一直到最后一个扇区，这个扇区编号叫做逻辑扇区号。逻辑扇区号抛弃了所有复杂的磁道、盘面之类的概念。当我们给出一个逻辑的扇区号时，硬盘的电子设备会将其转换成实际的盘面、磁道等这些位置。**

## 文件在磁盘中的结构

提到文件的读取，那么不得不提到文件系统这个操作系统中最为重要的组成部分之一。文件系统管理着磁盘中文件的存储方式，比如我们在 Linux 系统下有一个文件“/home/user/test.dat”,长度为 8000 个字节。那么我们在创建这个文件的时候，Linux 的 ext3 文件系统有可能将这个文件按照这样的方式存储在磁盘中：文件的前 4096 字节存储在磁盘的 1000 号扇区到 1007 号扇区，每个扇区 512 字节，8 个扇区刚好 4096 字节；文件的第 4097 个字节到第 8000 字节共 3904 个字节，存储在磁盘的 2000 号扇区到 2007 号扇区，8 个扇区也是 4096 字节，只不过只存储了 3904 个有效的字节，剩下的 192 个字节无效。如果把这个文件的存储方式看作是一个链状的结构，它的结构如图 1-4 所示。  
![alt text](/img/image-23.png)
文件系统保存了这些文件的存储结构，负责维护这些数据结构并且保证磁盘中的扇区能够有效地组织和利用。**那么当我们在 Linux 操作系统中，要读取这个文件的前 4096 个字节时，我们会使用一个 read 的系统调用来实现。文件系统收到 read 请求之后，判断出文件的前 4096 个字节位于磁盘的 1000 号逻辑扇区到 1007 号逻辑扇区。然后文件系统就向硬盘驱动发出一个读取逻辑扇区为 1000 号开始的 8 个扇区的请求，磁盘驱动程序收到这个请求以后就向硬盘发出硬件命令。** 向硬件发送 I/O 命令的方式有很多种，其中最为常见的一种就是通过读写 I/O 端口寄存器来实现。

## References

1. [程序员的自我修养--链接、装载与库，1.4.2]
